#ifdef ARDUINO
   #include "WProgram.h"
#elif defined PC
   #include <stdio.h>
#endif

#include "run.h"
#include "message.h"
#include "motor_controls.h"
#include "parser.h"

msg binary;
msg_pointer mp;

#ifdef ARDUINO
//Pins for testing
int ledPin = 13;

void setup(){
  moto_init();
}

void loop(){
  moto_run();
}
#endif

int main(void){
#ifdef ARDUINO
  setup();
  loop();
#elif defined PC
  int x;

  moto_init();
  moto_run();

#endif
}

int moto_init(void){
  mp = &binary;
#ifdef ARDUINO
  pinMode(ledPin, OUTPUT);
  Serial.begin(9600); 
#elif defined PC  
  x = 5;
#endif

  return 0;  
}


int moto_run(void){
#ifdef ARDUINO
  binary = scanHexMsgSTDIN();
  delay(2000);
  examineID(mp);
  
  if(leftMotor > 0 && rightMotor > 0 && frontMotor > 0 && rearMotor > 0){
    digitalWrite(13, HIGH);  
  }
  else
    digitalWrite(13, LOW);
  
  printMsg(mp);
  printMotorStatus();
  delay(5000);
#elif defined PC
  while(x != 0){
    binary = scanHexMsgSTDIN();
    examineID(mp);
    printMsg(mp);
    printMotorStatus();
    x--;
  }

#endif
  return 0;
}
